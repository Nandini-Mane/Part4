<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog List Expansions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 1.5rem;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .blog-post {
            border-bottom: 1px solid #e5e7eb;
            padding: 1.5rem 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .blog-post:last-child {
            border-bottom: none;
        }
        .button-group {
            display: flex;
            gap: 0.5rem;
        }
        .delete-btn {
            background-color: #ef4444;
            color: white;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            border: none;
        }
        .delete-btn:hover {
            background-color: #dc2626;
        }
        .like-btn {
            background-color: #3b82f6;
            color: white;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            border: none;
        }
        .like-btn:hover {
            background-color: #2563eb;
        }
        .likes-count {
            font-weight: 600;
            color: #4b5563;
        }
    </style>
</head>
<body class="bg-gray-100 p-8">

    <div class="container">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Blog Posts</h1>
        
        <div id="blog-list" class="space-y-4">
            <!-- Blog posts will be rendered here -->
        </div>
        
        <div id="status-message" class="mt-4 text-center hidden"></div>

        <div class="mt-8 border-t pt-6 border-gray-200">
            <h2 class="text-xl font-semibold mb-4">Add New Post</h2>
            <form id="add-blog-form" class="space-y-4">
                <div>
                    <label for="title" class="block text-sm font-medium text-gray-700">Title</label>
                    <input type="text" id="title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2" required>
                </div>
                <div>
                    <label for="content" class="block text-sm font-medium text-gray-700">Content</label>
                    <textarea id="content" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2" required></textarea>
                </div>
                <button type="submit" class="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Add Post</button>
            </form>
        </div>
    </div>

    <script>
        // Use a simple array to simulate a database.
        let blogPosts = [
            { id: 1, title: 'First Blog Post', content: 'This is the content of the first blog post. It\'s a great day to learn about new things.', likes: 5 },
            { id: 2, title: 'The Importance of Clean Code', content: 'Writing clean and maintainable code is a crucial skill for every developer. It helps with collaboration and long-term project health.', likes: 12 },
            { id: 3, title: 'RESTful API Conventions', content: 'Understanding RESTful principles is key to building scalable and robust web services. The DELETE method is used for removing resources.', likes: 8 }
        ];

        const blogListContainer = document.getElementById('blog-list');
        const statusMessage = document.getElementById('status-message');
        const addBlogForm = document.getElementById('add-blog-form');
        
        // This function simulates the RESTful DELETE API call.
        // It uses async/await syntax to mimic an asynchronous operation.
        async function deleteBlogPost(id) {
            try {
                // Simulate an API call with a 500ms delay.
                await new Promise(resolve => setTimeout(resolve, 500));

                const initialLength = blogPosts.length;
                blogPosts = blogPosts.filter(post => post.id !== id);
                
                if (blogPosts.length < initialLength) {
                    console.log(`Successfully deleted blog post with id: ${id}`);
                    renderPosts(); // Re-render the list after deletion
                    return true;
                } else {
                    throw new Error('Blog post not found.');
                }
            } catch (error) {
                console.error(`Error deleting blog post:`, error.message);
                return false;
            }
        }

        // New function to simulate the RESTful PUT/PATCH API call for likes.
        async function updateBlogPostLikes(id) {
            try {
                // Simulate an API call with a 500ms delay.
                await new Promise(resolve => setTimeout(resolve, 500));

                const postToUpdate = blogPosts.find(post => post.id === id);
                if (postToUpdate) {
                    postToUpdate.likes += 1; // Increment the likes count
                    console.log(`Successfully updated likes for post with id: ${id}`);
                    renderPosts(); // Re-render the list after update
                    return true;
                } else {
                    throw new Error('Blog post not found.');
                }
            } catch (error) {
                console.error(`Error updating blog post:`, error.message);
                return false;
            }
        }

        // Renders the blog posts to the DOM.
        function renderPosts() {
            blogListContainer.innerHTML = '';
            if (blogPosts.length === 0) {
                blogListContainer.innerHTML = '<p class="text-center text-gray-500">No blog posts to display. Add one above!</p>';
            }
            blogPosts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'blog-post';
                postElement.innerHTML = `
                    <div>
                        <h3 class="text-xl font-semibold text-gray-700">${post.title}</h3>
                        <p class="text-gray-600 mt-2">${post.content}</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="likes-count">${post.likes} likes</span>
                        <div class="button-group">
                            <button class="like-btn" data-id="${post.id}">Like</button>
                            <button class="delete-btn" data-id="${post.id}">Delete</button>
                        </div>
                    </div>
                `;
                blogListContainer.appendChild(postElement);
            });
        }
        
        // Add event listener to the list container to handle clicks on delete and like buttons.
        blogListContainer.addEventListener('click', async (event) => {
            const deleteButton = event.target.closest('.delete-btn');
            const likeButton = event.target.closest('.like-btn');

            if (deleteButton) {
                const id = parseInt(deleteButton.dataset.id);
                console.log(`Attempting to delete post with ID: ${id}`);
                statusMessage.textContent = 'Deleting...';
                statusMessage.classList.remove('hidden');

                const success = await deleteBlogPost(id);

                if (success) {
                    statusMessage.textContent = 'Post deleted successfully!';
                    statusMessage.classList.add('text-green-500');
                    statusMessage.classList.remove('text-red-500');
                } else {
                    statusMessage.textContent = 'Error: Post not found.';
                    statusMessage.classList.add('text-red-500');
                    statusMessage.classList.remove('text-green-500');
                }
            } else if (likeButton) {
                const id = parseInt(likeButton.dataset.id);
                console.log(`Attempting to like post with ID: ${id}`);
                statusMessage.textContent = 'Liking...';
                statusMessage.classList.remove('hidden');
                statusMessage.classList.remove('text-red-500');
                statusMessage.classList.remove('text-green-500');

                const success = await updateBlogPostLikes(id);

                if (success) {
                    statusMessage.textContent = 'Post liked successfully!';
                    statusMessage.classList.add('text-green-500');
                } else {
                    statusMessage.textContent = 'Error: Post not found.';
                    statusMessage.classList.add('text-red-500');
                }
            }
        });

        // Add event listener for the form to handle adding new posts.
        addBlogForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const titleInput = document.getElementById('title');
            const contentInput = document.getElementById('content');
            
            const newPost = {
                id: Date.now(), // Use a timestamp for a unique ID
                title: titleInput.value,
                content: contentInput.value,
                likes: 0
            };

            blogPosts.push(newPost);
            renderPosts();
            
            titleInput.value = '';
            contentInput.value = '';
            statusMessage.classList.add('hidden'); // Hide status message on new post
        });

        // --- Implementation of tests for the deletion functionality ---
        async function runDeleteTests() {
            console.log('--- Running tests for delete functionality ---');
            
            // Test Case 1: Deleting an existing post
            const postToDelete = blogPosts.find(p => p.id === 1);
            if (postToDelete) {
                const initialCount = blogPosts.length;
                console.log(`Test 1: Deleting post with ID ${postToDelete.id}...`);
                await deleteBlogPost(postToDelete.id);
                const afterDeleteCount = blogPosts.length;
                console.assert(initialCount === afterDeleteCount + 1, 'Test 1 Failed: Post was not deleted.');
                console.log('Test 1 Passed: Post was successfully deleted.');
            } else {
                console.warn('Test 1 skipped: No posts to delete.');
            }

            // Test Case 2: Attempting to delete a non-existent post
            const nonExistentId = 999;
            const initialCount = blogPosts.length;
            console.log(`Test 2: Attempting to delete non-existent post with ID ${nonExistentId}...`);
            const success = await deleteBlogPost(nonExistentId);
            const afterAttemptCount = blogPosts.length;
            console.assert(success === false, 'Test 2 Failed: Deletion of non-existent post returned success.');
            console.assert(initialCount === afterAttemptCount, 'Test 2 Failed: Blog list length changed.');
            console.log('Test 2 Passed: Deletion correctly failed and list was not changed.');

            console.log('--- Tests finished ---');
        }

        // --- Implementation of tests for the update functionality ---
        async function runUpdateTests() {
            console.log('--- Running tests for update functionality ---');
            
            // Test Case 1: Updating an existing post's likes
            const postToUpdate = blogPosts.find(p => p.id === 2);
            if (postToUpdate) {
                const initialLikes = postToUpdate.likes;
                console.log(`Test 1: Updating likes for post with ID ${postToUpdate.id}...`);
                await updateBlogPostLikes(postToUpdate.id);
                const afterUpdateLikes = blogPosts.find(p => p.id === 2).likes;
                console.assert(initialLikes + 1 === afterUpdateLikes, 'Test 1 Failed: Likes count was not incremented correctly.');
                console.log('Test 1 Passed: Likes count was successfully incremented.');
            } else {
                console.warn('Test 1 skipped: Post with ID 2 not found for update test.');
            }

            // Test Case 2: Attempting to update a non-existent post
            const nonExistentId = 999;
            console.log(`Test 2: Attempting to update non-existent post with ID ${nonExistentId}...`);
            const success = await updateBlogPostLikes(nonExistentId);
            console.assert(success === false, 'Test 2 Failed: Update of non-existent post returned success.');
            console.log('Test 2 Passed: Update correctly failed.');

            console.log('--- Tests finished ---');
        }

        // Initial render and test run
        renderPosts();
        runDeleteTests();
        runUpdateTests();
    </script>
</body>
</html>
